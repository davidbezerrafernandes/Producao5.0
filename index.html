<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operations Lab - An치lise de Correla칞칚o</title>
    <style>
        :root { --primary: #2563eb; --bg: #f8fafc; --text: #334155; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; max-width: 900px; margin: 0 auto; padding: 20px; background-color: var(--bg); color: var(--text); line-height: 1.6; }
        
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); margin-bottom: 20px; border: 1px solid #e2e8f0; }
        
        h1 { color: var(--primary); margin-top: 0; font-size: 1.8rem; }
        h2 { font-size: 1.2rem; border-bottom: 2px solid #e2e8f0; padding-bottom: 10px; margin-top: 0; }
        
        /* Estilo da 치rea de teoria (Novidade) */
        details { background-color: #f1f5f9; padding: 10px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #cbd5e1; }
        summary { cursor: pointer; font-weight: bold; color: var(--primary); outline: none; }
        .theory-content { margin-top: 10px; font-size: 0.9rem; color: #475569; }
        .theory-content ul { margin: 5px 0; padding-left: 20px; }

        textarea { width: 100%; height: 150px; border: 2px solid #e2e8f0; border-radius: 8px; padding: 12px; font-family: monospace; font-size: 14px; box-sizing: border-box; resize: vertical; }
        textarea:focus { border-color: var(--primary); outline: none; }

        .btn-group { margin-top: 15px; display: flex; gap: 10px; }
        
        button { background-color: var(--primary); color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 1rem; transition: background 0.2s; }
        button:hover { background-color: #1d4ed8; }
        button.secondary { background-color: #e2e8f0; color: #475569; }
        button.secondary:hover { background-color: #cbd5e1; }

        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #e2e8f0; }
        th { background-color: #f8fafc; color: #475569; font-weight: 600; }
        
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 0.85rem; font-weight: bold; }
        .alta { background-color: #dcfce7; color: #166534; } 
        .media { background-color: #fef9c3; color: #854d0e; } 
        .baixa { background-color: #f1f5f9; color: #64748b; } 
    </style>
</head>
<body>

    <div class="card">
        <h1>游늵 Operations Lab</h1>
        
        <details>
            <summary>游닄 Clique para ver a Base Te칩rica (Metodologia)</summary>
            <div class="theory-content">
                <p>Esta ferramenta utiliza o <strong>Coeficiente de Correla칞칚o de Pearson ($r$)</strong> para identificar quais vari치veis de entrada (Inputs) impactam o resultado do processo (Outputs).</p>
                <ul>
                    <li><strong>Vari치vel Dependente (Y):</strong> 칄 o resultado que voc칡 quer melhorar (ex: Produtividade, Lucro). Deve ser a <strong>1춹 Coluna</strong>.</li>
                    <li><strong>Vari치veis Independentes (X):</strong> S칚o os fatores que controlam o processo (ex: Temperatura, M칚o de obra, Velocidade).</li>
                    <li><strong>Interpreta칞칚o:</strong> Baseado em <em>Slack et al. (2009)</em> e princ칤pios de <em>Six Sigma</em>:
                        <ul>
                            <li><strong>Alta Correla칞칚o (>0.7):</strong> Indica uma "Vari치vel Determinante". 칄 aqui que o gestor deve focar.</li>
                            <li><strong>Correla칞칚o Negativa:</strong> Quando um fator aumenta, o desempenho cai (rela칞칚o inversa).</li>
                        </ul>
                    </li>
                </ul>
            </div>
        </details>

        <label for="dataInput"><strong>Entrada de Dados:</strong> (Copie do Excel e cole abaixo)</label>
        <p style="font-size: 0.85rem; color: #64748b; margin-top: 0;">Lembre-se: A 1춹 coluna deve ser o seu OBJETIVO (Output).</p>
        
        <textarea id="dataInput" placeholder="Exemplo:
Produ칞칚o	Funcionarios	Temperatura
100	10	25
120	12	24
..."></textarea>

        <div class="btn-group">
            <button onclick="analisarDados()">游 Calcular Correla칞칚o</button>
            <button class="secondary" onclick="carregarExemplo()">Carregar Exemplo Did치tico</button>
        </div>
    </div>

    <div id="resultArea" class="card" style="display: none;">
        <h2>游늶 Relat칩rio de An치lise</h2>
        <p>Objetivo Analisado (Vari치vel Y): <strong id="targetName" style="color: #d97706;">---</strong></p>
        
        <div id="conclusaoBox" style="margin-bottom: 20px; font-size: 1.1em;"></div>
        
        <div style="overflow-x: auto;">
            <table id="tabelaResultados">
                <thead>
                    <tr>
                        <th>Vari치vel de Processo (X)</th>
                        <th>칈ndice Pearson ($r$)</th>
                        <th>Impacto no Processo</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <script>
        function carregarExemplo() {
            // Exemplo baseado em um cen치rio de f치brica onde a velocidade afeta a produ칞칚o
            const exemplo = `Produ칞칚o_Total	Qtd_Funcionarios	Temperatura_Fabrica	Velocidade_Esteira
500	10	22	2
550	11	23	2.5
480	10	21	1.8
700	12	22	4.0
680	12	24	3.8
510	10	25	2.1
720	13	22	4.2`;
            document.getElementById('dataInput').value = exemplo;
        }

        function analisarDados() {
            const rawData = document.getElementById('dataInput').value.trim();
            if (!rawData) { alert("Por favor, insira dados."); return; }

            const rows = rawData.split('\n').map(r => r.trim()).filter(r => r);
            
            // Detec칞칚o autom치tica de separador
            const firstRow = rows[0];
            let separator = '\t';
            if (firstRow.includes('\t')) separator = '\t';
            else if (firstRow.includes(';')) separator = ';';
            else if (firstRow.includes(',')) separator = ',';

            const headers = rows[0].split(separator).map(h => h.trim());
            const dataRows = rows.slice(1);

            if (headers.length < 2) {
                alert("Erro: Insira pelo menos 2 colunas."); return;
            }

            let colunas = headers.map(() => []);
            
            dataRows.forEach(rowStr => {
                const vals = rowStr.split(separator);
                vals.forEach((v, i) => {
                    if (i < colunas.length) {
                        let num = parseFloat(v.replace(',', '.'));
                        if (!isNaN(num)) colunas[i].push(num);
                    }
                });
            });

            const nomeTarget = headers[0];
            const y = colunas[0]; 
            let resultados = [];

            for (let i = 1; i < colunas.length; i++) {
                let x = colunas[i];
                if (x.length === y.length && x.length > 0) {
                    let r = calcularCorrelacao(x, y);
                    resultados.push({
                        nome: headers[i],
                        correlacao: r,
                        abs: Math.abs(r)
                    });
                }
            }

            resultados.sort((a, b) => b.abs - a.abs);

            document.getElementById('targetName').innerText = nomeTarget;
            const tbody = document.querySelector('#tabelaResultados tbody');
            tbody.innerHTML = '';

            resultados.forEach(res => {
                let classe = 'baixa';
                let texto = 'Baixo';
                
                if (res.abs > 0.75) { classe = 'alta'; texto = 'Determinante (Cr칤tico)'; }
                else if (res.abs > 0.4) { classe = 'media'; texto = 'Moderado'; }

                let sinal = res.correlacao > 0 ? "+" : "-"; // Positiva ou Negativa

                const tr = `<tr>
                    <td>${res.nome}</td>
                    <td><strong>${res.correlacao.toFixed(3)}</strong> (${sinal})</td>
                    <td><span class="badge ${classe}">${texto}</span></td>
                </tr>`;
                tbody.innerHTML += tr;
            });

            if (
        <button onclick="analisarDados()">Analisar Correla칞칚o</button>

        <div id="result" class="result-box">
            <h3>Resultado da An치lise:</h3>
            <p id="conclusao"></p>
            <div id="tabelaResultado"></div>
        </div>
    </div>

    <script>
        function analisarDados() {
            const rawData = document.getElementById('dataInput').value.trim();
            if (!rawData) { alert("Por favor, cole os dados primeiro."); return; }

            // 1. Processar os dados (CSV/Tab)
            const rows = rawData.split('\n').map(row => row.split(/\t|,|;/)); // Aceita Tab, Virgula ou Ponto e virgula
            const headers = rows[0];
            const data = rows.slice(1);

            // Preparar colunas
            let colunas = headers.map(() => []);
            
            data.forEach(row => {
                row.forEach((val, index) => {
                    if (val.trim() !== "") {
                        colunas[index].push(parseFloat(val.replace(',', '.')));
                    }
                });
            });

            // A Coluna 0 칠 o Y (Desempenho/Produ칞칚o)
            const y = colunas[0];
            let resultados = [];

            // 2. Calcular Correla칞칚o para cada vari치vel (X)
            for (let i = 1; i < colunas.length; i++) {
                let x = colunas[i];
                let r = calcularCorrelacao(x, y);
                resultados.push({
                    nome: headers[i],
                    correlacao: r,
                    impacto: Math.abs(r) // Para saber a for칞a, independente se 칠 positiva ou negativa
                });
            }

            // Ordenar pelo maior impacto
            resultados.sort((a, b) => b.impacto - a.impacto);

            // 3. Exibir Resultados
            let html = "<table><tr><th>Vari치vel</th><th>Correla칞칚o (Impacto)</th><th>Interpreta칞칚o</th></tr>";
            
            resultados.forEach(res => {
                let cor = res.correlacao > 0 ? "Positiva (Ajuda)" : "Negativa (Atrapalha)";
                let forca = res.impacto > 0.7 ? "Muito Forte" : (res.impacto > 0.4 ? "Moderada" : "Fraca");
                
                html += `<tr>
                    <td>${res.nome}</td>
                    <td class="highlight">${res.correlacao.toFixed(4)}</td>
                    <td>${forca} / ${cor}</td>
                </tr>`;
            });
            html += "</table>";

            const vencedor = resultados[0];
            const textoVencedor = `A vari치vel determinante 칠 <strong>"${vencedor.nome}"</strong> com uma correla칞칚o de ${vencedor.correlacao.toFixed(2)}. <br>Isso significa que quando ela muda, a produ칞칚o muda junto.`;

            document.getElementById('tabelaResultado').innerHTML = html;
            document.getElementById('conclusao').innerHTML = textoVencedor;
            document.getElementById('result').style.display = 'block';
        }

        // Fun칞칚o Matem치tica: Correla칞칚o de Pearson
        function calcularCorrelacao(x, y) {
            let n = x.length;
            let sum_x = 0, sum_y = 0, sum_xy = 0, sum_x2 = 0, sum_y2 = 0;

            for (let i = 0; i < n; i++) {
                sum_x += x[i];
                sum_y += y[i];
                sum_xy += x[i] * y[i];
                sum_x2 += x[i] * x[i];
                sum_y2 += y[i] * y[i];
            }

            let numerador = (n * sum_xy) - (sum_x * sum_y);
            let denominador = Math.sqrt((n * sum_x2 - sum_x * sum_x) * (n * sum_y2 - sum_y * sum_y));

            if (denominador === 0) return 0;
            return numerador / denominador;
        }
    </script>
</body>
</html>
