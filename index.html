<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operations Lab - An치lise Gr치fica</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root { --primary: #2563eb; --bg: #f8fafc; --text: #334155; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; max-width: 900px; margin: 0 auto; padding: 20px; background-color: var(--bg); color: var(--text); line-height: 1.6; }
        
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); margin-bottom: 20px; border: 1px solid #e2e8f0; }
        
        h1 { color: var(--primary); margin-top: 0; font-size: 1.8rem; }
        h2 { font-size: 1.2rem; border-bottom: 2px solid #e2e8f0; padding-bottom: 10px; margin-top: 0; }
        
        /* Layout dos Gr치ficos */
        .charts-wrapper { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        .chart-box { background: #fff; padding: 15px; border: 1px solid #e2e8f0; border-radius: 8px; }
        @media (max-width: 700px) { .charts-wrapper { grid-template-columns: 1fr; } }

        details { background-color: #f1f5f9; padding: 10px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #cbd5e1; }
        summary { cursor: pointer; font-weight: bold; color: var(--primary); outline: none; }
        .theory-content { margin-top: 10px; font-size: 0.9rem; color: #475569; }

        textarea { width: 100%; height: 120px; border: 2px solid #e2e8f0; border-radius: 8px; padding: 12px; font-family: monospace; font-size: 14px; box-sizing: border-box; resize: vertical; }
        textarea:focus { border-color: var(--primary); outline: none; }

        .btn-group { margin-top: 15px; display: flex; gap: 10px; }
        button { background-color: var(--primary); color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 1rem; transition: background 0.2s; }
        button:hover { background-color: #1d4ed8; }
        button.secondary { background-color: #e2e8f0; color: #475569; }
        button.secondary:hover { background-color: #cbd5e1; }

        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #e2e8f0; }
        th { background-color: #f8fafc; color: #475569; font-weight: 600; }
        
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 0.85rem; font-weight: bold; }
        .alta { background-color: #dcfce7; color: #166534; } 
        .media { background-color: #fef9c3; color: #854d0e; } 
        .baixa { background-color: #f1f5f9; color: #64748b; } 
    </style>
</head>
<body>

    <div class="card">
        <h1>游늵 Operations Lab <span style="font-size:0.6em; color:#64748b;">v4.0</span></h1>
        
        <details>
            <summary>游닄 Base Te칩rica (Metodologia)</summary>
            <div class="theory-content">
                <p>Esta ferramenta utiliza estat칤stica descritiva e inferencial para gest칚o:</p>
                <ul>
                    <li><strong>Gr치fico de Dispers칚o (Scatter Plot):</strong> Visualiza칞칚o recomendada por <em>Ishikawa</em> para validar rela칞칫es de causa e efeito. Se os pontos formarem uma diagonal, a hip칩tese 칠 confirmada.</li>
                    <li><strong>Coeficiente de Pearson ($r$):</strong> Mede a for칞a da correla칞칚o. <br> $r > 0.7$: Forte correla칞칚o (Vari치vel Cr칤tica).</li>
                </ul>
            </div>
        </details>

        <label for="dataInput"><strong>Cole seus dados do Excel:</strong> (1춹 Coluna deve ser o OBJETIVO/RESULTADO)</label>
        <textarea id="dataInput" placeholder="Exemplo:
Produ칞칚o	Funcionarios	Temperatura
100	10	25
120	12	24..."></textarea>

        <div class="btn-group">
            <button onclick="analisarDados()">游 Analisar e Gerar Gr치ficos</button>
            <button class="secondary" onclick="carregarExemplo()">Carregar Exemplo</button>
        </div>
    </div>

    <div id="resultArea" class="card" style="display: none;">
        <h2>游늶 Diagn칩stico Visual</h2>
        <div id="conclusaoBox" style="margin-bottom: 20px; font-size: 1.1em;"></div>

        <div class="charts-wrapper">
            <div class="chart-box">
                <h3 style="margin-top:0; font-size:1rem; color:#64748b;">Prova Real (Dispers칚o)</h3>
                <canvas id="scatterChart"></canvas>
                <small style="display:block; margin-top:5px; color:#94a3b8; font-size:0.8em;">Cruza a Melhor Vari치vel (X) vs Resultado (Y)</small>
            </div>
            <div class="chart-box">
                <h3 style="margin-top:0; font-size:1rem; color:#64748b;">Ranking de Impacto</h3>
                <canvas id="barChart"></canvas>
            </div>
        </div>
        
        <h3 style="margin-top: 30px; font-size:1rem; color:#64748b;">Tabela Detalhada</h3>
        <div style="overflow-x: auto;">
            <table id="tabelaResultados">
                <thead>
                    <tr>
                        <th>Vari치vel (Causa)</th>
                        <th>칈ndice Pearson ($r$)</th>
                        <th>Classifica칞칚o</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <script>
        // Vari치veis globais para controlar os gr치ficos (para poder destruir e recriar)
        let scatterChartInstance = null;
        let barChartInstance = null;

        function carregarExemplo() {
            // Exemplo com correla칞칚o forte na velocidade
            const exemplo = `Defeitos	Velocidade	Temperatura
12	800	25
14	850	26
11	780	24
25	1200	25
28	1250	23
13	810	27
30	1300	24
12	790	26
45	1600	25
15	860	22`;
            document.getElementById('dataInput').value = exemplo;
        }

        function analisarDados() {
            const rawData = document.getElementById('dataInput').value.trim();
            if (!rawData) { alert("Sem dados para analisar."); return; }

            const rows = rawData.split('\n').map(r => r.trim()).filter(r => r);
            const firstRow = rows[0];
            let separator = firstRow.includes('\t') ? '\t' : (firstRow.includes(';') ? ';' : ',');

            const headers = rows[0].split(separator).map(h => h.trim());
            const dataRows = rows.slice(1);

            if (headers.length < 2) { alert("Preciso de pelo menos 2 colunas."); return; }

            let colunas = headers.map(() => []);
            dataRows.forEach(rowStr => {
                const vals = rowStr.split(separator);
                vals.forEach((v, i) => {
                    if (i < colunas.length) {
                        let num = parseFloat(v.replace(',', '.'));
                        if (!isNaN(num)) colunas[i].push(num);
                    }
                });
            });

            const nomeTarget = headers[0];
            const y = colunas[0]; 
            let resultados = [];

            for (let i = 1; i < colunas.length; i++) {
                let x = colunas[i];
                if (x.length === y.length && x.length > 0) {
                    let r = calcularCorrelacao(x, y);
                    resultados.push({
                        nome: headers[i],
                        correlacao: r,
                        abs: Math.abs(r),
                        dados: x // Salvando os dados brutos para o gr치fico
                    });
                }
            }

            // Ordena pelo maior impacto absoluto
            resultados.sort((a, b) => b.abs - a.abs);

            // Renderizar Tabela
            const tbody = document.querySelector('#tabelaResultados tbody');
            tbody.innerHTML = '';
            resultados.forEach(res => {
                let classe = res.abs > 0.75 ? 'alta' : (res.abs > 0.4 ? 'media' : 'baixa');
                let texto = res.abs > 0.75 ? 'Determinante' : (res.abs > 0.4 ? 'Moderado' : 'Baixo');
                let sinal = res.correlacao > 0 ? "+" : "-";
                
                tbody.innerHTML += `<tr>
                    <td>${res.nome}</td>
                    <td><strong>${res.correlacao.toFixed(3)}</strong> (${sinal})</td>
                    <td><span class="badge ${classe}">${texto}</span></td>
                </tr>`;
            });

            // Conclus칚o em Texto
            if (resultados.length > 0) {
                const vencedor = resultados[0];
                document.getElementById('conclusaoBox').innerHTML = `游댌 <strong>Diagn칩stico:</strong> A vari치vel determinante 칠 <strong>${vencedor.nome}</strong>.<br>Ela explica matematicamente o comportamento de <em>${nomeTarget}</em>.`;
                
                // Gerar Gr치ficos
                gerarGraficos(vencedor, y, nomeTarget, resultados);
            }

            document.getElementById('resultArea').style.display = 'block';
            document.getElementById('resultArea').scrollIntoView({ behavior: 'smooth' });
        }

        function gerarGraficos(vencedor, yData, nomeY, todosResultados) {
            // 1. Gr치fico de Dispers칚o (Scatter)
            const ctxScatter = document.getElementById('scatterChart').getContext('2d');
            
            // Criar pontos XY
            const pontos = vencedor.dados.map((val, i) => ({ x: val, y: yData[i] }));

            if (scatterChartInstance) scatterChartInstance.destroy(); // Limpa anterior

            scatterChartInstance = new Chart(ctxScatter, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: `${vencedor.nome} vs ${nomeY}`,
                        data: pontos,
                        backgroundColor: 'rgba(37, 99, 235, 0.7)', // Azul
                        borderColor: '#2563eb',
                        borderWidth: 1,
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { title: { display: true, text: vencedor.nome } },
                        y: { title: { display: true, text: nomeY } }
                    }
                }
            });

            // 2. Gr치fico de Barras (Ranking)
            const ctxBar = document.getElementById('barChart').getContext('2d');
            const labels = todosResultados.map(r => r.nome);
            const dataValues = todosResultados.map(r => r.abs);
            const cores = dataValues.map(v => v > 0.7 ? '#166534' : (v > 0.4 ? '#d97706' : '#94a3b8')); // Verde, Amarelo, Cinza

            if (barChartInstance) barChartInstance.destroy();

            barChartInstance = new Chart(ctxBar, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'For칞a da Correla칞칚o (0 a 1)',
                        data: dataValues,
                        backgroundColor: cores,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    indexAxis: 'y', // Barra horizontal 칠 melhor para ler nomes
                    plugins: { legend: { display: false } },
                    scales: { x: { min: 0, max: 1 } }
                }
            });
        }

        function calcularCorrelacao(x, y) {
            let n = x.length;
            let sum_x = 0, sum_y = 0, sum_xy = 0, sum_x2 = 0, sum_y2 = 0;
            for (let i = 0; i < n; i++) {
                sum_x += x[i];
                sum_y += y[i];
                sum_xy += x[i] * y[i];
                sum_x2 += x[i] * x[i];
                sum_y2 += y[i] * y[i];
            }
            let num = (n * sum_xy) - (sum_x * sum_y);
            let den = Math.sqrt((n * sum_x2 - sum_x * sum_x) * (n * sum_y2 - sum_y * sum_y));
            return den === 0 ? 0 : num / den;
        }
    </script>
</body>
</html>
        .alta { background-color: #dcfce7; color: #166534; } 
        .media { background-color: #fef9c3; color: #854d0e; } 
        .baixa { background-color: #f1f5f9; color: #64748b; } 
    </style>
</head>
<body>

    <div class="card">
        <h1>游늵 Operations Lab</h1>
        
        <details>
            <summary>游닄 Clique para ver a Base Te칩rica (Metodologia)</summary>
            <div class="theory-content">
                <p>Esta ferramenta utiliza o <strong>Coeficiente de Correla칞칚o de Pearson ($r$)</strong> para identificar quais vari치veis de entrada (Inputs) impactam o resultado do processo (Outputs).</p>
                <ul>
                    <li><strong>Vari치vel Dependente (Y):</strong> 칄 o resultado que voc칡 quer melhorar (ex: Produtividade, Lucro). Deve ser a <strong>1춹 Coluna</strong>.</li>
                    <li><strong>Vari치veis Independentes (X):</strong> S칚o os fatores que controlam o processo (ex: Temperatura, M칚o de obra, Velocidade).</li>
                    <li><strong>Interpreta칞칚o:</strong> Baseado em <em>Slack et al. (2009)</em> e princ칤pios de <em>Six Sigma</em>:
                        <ul>
                            <li><strong>Alta Correla칞칚o (>0.7):</strong> Indica uma "Vari치vel Determinante". 칄 aqui que o gestor deve focar.</li>
                            <li><strong>Correla칞칚o Negativa:</strong> Quando um fator aumenta, o desempenho cai (rela칞칚o inversa).</li>
                        </ul>
                    </li>
                </ul>
            </div>
        </details>

        <label for="dataInput"><strong>Entrada de Dados:</strong> (Copie do Excel e cole abaixo)</label>
        <p style="font-size: 0.85rem; color: #64748b; margin-top: 0;">Lembre-se: A 1춹 coluna deve ser o seu OBJETIVO (Output).</p>
        
        <textarea id="dataInput" placeholder="Exemplo:
Produ칞칚o	Funcionarios	Temperatura
100	10	25
120	12	24
..."></textarea>

        <div class="btn-group">
            <button onclick="analisarDados()">游 Calcular Correla칞칚o</button>
            <button class="secondary" onclick="carregarExemplo()">Carregar Exemplo Did치tico</button>
        </div>
    </div>

    <div id="resultArea" class="card" style="display: none;">
        <h2>游늶 Relat칩rio de An치lise</h2>
        <p>Objetivo Analisado (Vari치vel Y): <strong id="targetName" style="color: #d97706;">---</strong></p>
        
        <div id="conclusaoBox" style="margin-bottom: 20px; font-size: 1.1em;"></div>
        
        <div style="overflow-x: auto;">
            <table id="tabelaResultados">
                <thead>
                    <tr>
                        <th>Vari치vel de Processo (X)</th>
                        <th>칈ndice Pearson ($r$)</th>
                        <th>Impacto no Processo</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <script>
        function carregarExemplo() {
            // Exemplo baseado em um cen치rio de f치brica onde a velocidade afeta a produ칞칚o
            const exemplo = `Produ칞칚o_Total	Qtd_Funcionarios	Temperatura_Fabrica	Velocidade_Esteira
500	10	22	2
550	11	23	2.5
480	10	21	1.8
700	12	22	4.0
680	12	24	3.8
510	10	25	2.1
720	13	22	4.2`;
            document.getElementById('dataInput').value = exemplo;
        }

        function analisarDados() {
            const rawData = document.getElementById('dataInput').value.trim();
            if (!rawData) { alert("Por favor, insira dados."); return; }

            const rows = rawData.split('\n').map(r => r.trim()).filter(r => r);
            
            // Detec칞칚o autom치tica de separador
            const firstRow = rows[0];
            let separator = '\t';
            if (firstRow.includes('\t')) separator = '\t';
            else if (firstRow.includes(';')) separator = ';';
            else if (firstRow.includes(',')) separator = ',';

            const headers = rows[0].split(separator).map(h => h.trim());
            const dataRows = rows.slice(1);

            if (headers.length < 2) {
                alert("Erro: Insira pelo menos 2 colunas."); return;
            }

            let colunas = headers.map(() => []);
            
            dataRows.forEach(rowStr => {
                const vals = rowStr.split(separator);
                vals.forEach((v, i) => {
                    if (i < colunas.length) {
                        let num = parseFloat(v.replace(',', '.'));
                        if (!isNaN(num)) colunas[i].push(num);
                    }
                });
            });

            const nomeTarget = headers[0];
            const y = colunas[0]; 
            let resultados = [];

            for (let i = 1; i < colunas.length; i++) {
                let x = colunas[i];
                if (x.length === y.length && x.length > 0) {
                    let r = calcularCorrelacao(x, y);
                    resultados.push({
                        nome: headers[i],
                        correlacao: r,
                        abs: Math.abs(r)
                    });
                }
            }

            resultados.sort((a, b) => b.abs - a.abs);

            document.getElementById('targetName').innerText = nomeTarget;
            const tbody = document.querySelector('#tabelaResultados tbody');
            tbody.innerHTML = '';

            resultados.forEach(res => {
                let classe = 'baixa';
                let texto = 'Baixo';
                
                if (res.abs > 0.75) { classe = 'alta'; texto = 'Determinante (Cr칤tico)'; }
                else if (res.abs > 0.4) { classe = 'media'; texto = 'Moderado'; }

                let sinal = res.correlacao > 0 ? "+" : "-"; // Positiva ou Negativa

                const tr = `<tr>
                    <td>${res.nome}</td>
                    <td><strong>${res.correlacao.toFixed(3)}</strong> (${sinal})</td>
                    <td><span class="badge ${classe}">${texto}</span></td>
                </tr>`;
                tbody.innerHTML += tr;
            });

            if (
        <button onclick="analisarDados()">Analisar Correla칞칚o</button>

        <div id="result" class="result-box">
            <h3>Resultado da An치lise:</h3>
            <p id="conclusao"></p>
            <div id="tabelaResultado"></div>
        </div>
    </div>

    <script>
        function analisarDados() {
            const rawData = document.getElementById('dataInput').value.trim();
            if (!rawData) { alert("Por favor, cole os dados primeiro."); return; }

            // 1. Processar os dados (CSV/Tab)
            const rows = rawData.split('\n').map(row => row.split(/\t|,|;/)); // Aceita Tab, Virgula ou Ponto e virgula
            const headers = rows[0];
            const data = rows.slice(1);

            // Preparar colunas
            let colunas = headers.map(() => []);
            
            data.forEach(row => {
                row.forEach((val, index) => {
                    if (val.trim() !== "") {
                        colunas[index].push(parseFloat(val.replace(',', '.')));
                    }
                });
            });

            // A Coluna 0 칠 o Y (Desempenho/Produ칞칚o)
            const y = colunas[0];
            let resultados = [];

            // 2. Calcular Correla칞칚o para cada vari치vel (X)
            for (let i = 1; i < colunas.length; i++) {
                let x = colunas[i];
                let r = calcularCorrelacao(x, y);
                resultados.push({
                    nome: headers[i],
                    correlacao: r,
                    impacto: Math.abs(r) // Para saber a for칞a, independente se 칠 positiva ou negativa
                });
            }

            // Ordenar pelo maior impacto
            resultados.sort((a, b) => b.impacto - a.impacto);

            // 3. Exibir Resultados
            let html = "<table><tr><th>Vari치vel</th><th>Correla칞칚o (Impacto)</th><th>Interpreta칞칚o</th></tr>";
            
            resultados.forEach(res => {
                let cor = res.correlacao > 0 ? "Positiva (Ajuda)" : "Negativa (Atrapalha)";
                let forca = res.impacto > 0.7 ? "Muito Forte" : (res.impacto > 0.4 ? "Moderada" : "Fraca");
                
                html += `<tr>
                    <td>${res.nome}</td>
                    <td class="highlight">${res.correlacao.toFixed(4)}</td>
                    <td>${forca} / ${cor}</td>
                </tr>`;
            });
            html += "</table>";

            const vencedor = resultados[0];
            const textoVencedor = `A vari치vel determinante 칠 <strong>"${vencedor.nome}"</strong> com uma correla칞칚o de ${vencedor.correlacao.toFixed(2)}. <br>Isso significa que quando ela muda, a produ칞칚o muda junto.`;

            document.getElementById('tabelaResultado').innerHTML = html;
            document.getElementById('conclusao').innerHTML = textoVencedor;
            document.getElementById('result').style.display = 'block';
        }

        // Fun칞칚o Matem치tica: Correla칞칚o de Pearson
        function calcularCorrelacao(x, y) {
            let n = x.length;
            let sum_x = 0, sum_y = 0, sum_xy = 0, sum_x2 = 0, sum_y2 = 0;

            for (let i = 0; i < n; i++) {
                sum_x += x[i];
                sum_y += y[i];
                sum_xy += x[i] * y[i];
                sum_x2 += x[i] * x[i];
                sum_y2 += y[i] * y[i];
            }

            let numerador = (n * sum_xy) - (sum_x * sum_y);
            let denominador = Math.sqrt((n * sum_x2 - sum_x * sum_x) * (n * sum_y2 - sum_y * sum_y));

            if (denominador === 0) return 0;
            return numerador / denominador;
        }
    </script>
</body>
</html>
